<!-- templates/chat.html -->
{% extends 'base.html' %}

{% block title %}Chat - InstaClone{% endblock %}

{% block content %}
<h3>Live Chat</h3>
<div class="card">
  <div class="card-body" id="chat-box" style="height: 300px; overflow-y: scroll; background: #f9f9f9;"></div>
  <div class="card-footer">
    <form id="chat-form">
      <div class="input-group">
        <input type="text" class="form-control" id="chat-message" placeholder="Type your message...">
        <emoji-picker style="position: absolute; bottom: 50px; right: 20px;"></emoji-picker>
        <button class="btn btn-primary" type="submit">Send</button>
      </div>
    </form>
  </div>
</div>

<script>
  const socket = io();

  const chatForm = document.getElementById('chat-form');
  const chatBox = document.getElementById('chat-box');
  const messageInput = document.getElementById('chat-message');

  chatForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const msg = messageInput.value;
    if (msg.trim()) {
      socket.emit('send_message', msg);
      messageInput.value = '';
    }
  });

  socket.on('receive_message', function(msg) {
    const p = document.createElement('p');
    p.textContent = msg;
    chatBox.appendChild(p);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>
{% endblock %}